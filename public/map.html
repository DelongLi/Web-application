<!doctype html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="msapplication-TileColor" content="#0061da">
    <meta name="theme-color" content="#1643a3">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="description" content="">
    <meta name="author" content="">

    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">


    <!-- Title -->
    <title>User Page</title>
    <link rel="stylesheet" href="assets\fonts\fonts\font-awesome.min.css">

    <!-- Sidemenu Css -->
    <link href="assets\plugins\fullside-menu\css\style.css" rel="stylesheet">
    <link href="assets\plugins\fullside-menu\waves.min.css" rel="stylesheet">

    <!-- Dashboard Css -->
    <link href="assets\css\dashboard.css" rel="stylesheet">

    <!-- Morris.js Charts Plugin -->
    <link href="assets\plugins\morris\morris.css" rel="stylesheet">

    <!-- Custom scroll bar css-->
    <link href="assets\plugins\scroll-bar\jquery.mCustomScrollbar.css" rel="stylesheet">

    <!---Font icons-->
    <link href="assets\css\icons.css" rel="stylesheet">

    <!-- home-page -->
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    <title>CloudFitness</title>
    <!-- Reset CSS -->
    <link href="css/reset.css" rel="stylesheet" type="text/css">
    <!-- Bootstrap -->
    <link href="assets-user/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <!-- Font Awesome -->
    <link href="assets-user/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- Iconmoon -->
    <link href="assets-user/iconmoon/css/iconmoon.css" rel="stylesheet" type="text/css">
    <!-- Lightbox CSS -->
    <link href="assets-user/lightbox/css/lightbox.css" rel="stylesheet" type="text/css">
    <!-- Owl Carousel -->
    <link href="assets-user/owl-carousel/css/owl.carousel.min.css" rel="stylesheet" type="text/css">
    <!-- Animate -->
    <link href="css/animate.css" rel="stylesheet" type="text/css">
    <!-- Aos -->
    <link href="assets-user/aos/aos.css" rel="stylesheet" type="text/css">
    <!-- Custom Style -->
    <link href="css/custom.css" rel="stylesheet" type="text/css">






</head>

<body class="">

<!-- Start Preloader -->
<div id="loading">
    <div class="element">
        <div class="sk-folding-cube">
            <div class="sk-cube1 sk-cube"></div>
            <div class="sk-cube2 sk-cube"></div>
            <div class="sk-cube4 sk-cube"></div>
            <div class="sk-cube3 sk-cube"></div>
        </div>
    </div>
</div>
<!-- End Preloader -->

<!-- Start Header -->
<header>
    <!-- Start Header Sec -->
    <div class="container header-sec">
        <div class="row">

            <!-- 按icon返回主页面 更换logo-->

            <span class="col-xs-12 col-sm-3 logo"><img class="main" src="images/logo.png" alt="Fitness Gym"><img class="fix" src="images/logo-fix.png" alt="Fitness Gym"></span>
            <div class="col-xs-12 col-sm-9 header-right">


                <!-- Start Navigation -->
                <nav class="navbar navbar-expand-md navbar-dark navbar-custom">
                    <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="navbar-collapse" id="navbarNavDropdown">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="homepage.html">Home</a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="workout-tip.html">Work-Out  Tip</a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="schedule.html">Event  Schedule</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="about-us.html">About  Us</a>
                            </li>
                            <li class="nav-item">
                                <!-- logout -->
                                <form class="nav-link" action="logout" method="get">

                                    <button type="submit" class="btn btn-primary validate green"><span class="glyphicon glyphicon-log-in"></span> Log-Out</button>
                                </form>

                            </li>

                        </ul>
                    </div>
                </nav>
                <!-- End Navigation -->
            </div>
        </div>
    </div>
    <!-- End Header Sec -->
</header>
<!-- End Header -->


<!-- Start Banner -->
<div class="banner-outer inner-banner classes-banner">
    <span class="banner-shadow"></span>
    <div class="container">
        <div class="content" data-aos="fade-down">
            <div class="breadcrumbs_outer">
                <div class="container">
                    <ul class="breadcrumbs">

                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Banner -->




<div id="global-loader"></div>




<div class="page">
    <div class="page-main">

        <!-- serach row -->
        <div class="app-header1 header py-1 d-flex" style="background-color:#ED9640">
            <div class="container-fluid"style="background-color:#ED9640">
                <div class="d-flex" style="background-color:#ED9640">

                    <div class="menu-toggle-button" style="background-color:#ED9640">
                        <a class="nav-link wave-effect" href="#" id="sidebarCollapse">
                            <span class="fa fa-bars"></span>
                        </a>
                    </div>
                    <div class="d-flex order-lg-2 ml-auto header-right-icons header-search-icon">
                        <div class="p-2">
                            <form class="input-icon ">
                                <div class="input-icon-addon">
                                    <i class="fe fe-search"></i>
                                </div>
                                <input type="search" class="form-control header-search" placeholder="Search&hellip;" tabindex="1">
                            </form>
                        </div>

                        <div class="dropdown d-none d-md-flex">
                            <a class="nav-link icon full-screen-link nav-link-bg">
                                <i class="fa fa-expand" id="fullscreen-button"></i>
                            </a>
                        </div>


                        <div class="dropdown d-none d-md-flex ">
                            <a class="nav-link icon " data-toggle="dropdown">
                                <i class="fe fe-grid floating"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                                <ul class="drop-icon-wrap p-1">
                                    <li>
                                        <a href="email.html" class="drop-icon-item">
                                            <i class="fe fe-mail text-dark"></i>
                                            <span class="block"> E-mail</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="calendar2.html" class="drop-icon-item">
                                            <i class="fe fe-calendar text-dark"></i>
                                            <span class="block">calendar</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="maps.html" class="drop-icon-item">
                                            <i class="fe fe-map-pin text-dark"></i>
                                            <span class="block">map</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="cart.html" class="drop-icon-item">
                                            <i class="fe fe-shopping-cart text-dark"></i>
                                            <span class="block">Cart</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="chat.html" class="drop-icon-item">
                                            <i class="fe fe-message-square text-dark"></i>
                                            <span class="block">chat</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="profile.html" class="drop-icon-item">
                                            <i class="fe fe-phone-outgoing text-dark"></i>
                                            <span class="block">contact</span>
                                        </a>
                                    </li>
                                </ul>
                                <div class="dropdown-divider"></div>
                                <a href="#" class="dropdown-item text-center">View all</a>
                            </div>
                        </div>
                        <div class="dropdown text-center selector">
                            <a href="#" class="nav-link leading-none" data-toggle="dropdown">

                                <!-- 用户照片 -->
                                <span class="avatar avatar-sm brround cover-image" data-image-src="assets/images/faces/profilePic.jpg"></span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow ">
                                <div class="text-center">
                                    <a href="#" class="dropdown-item text-center font-weight-sembold user" data-toggle="dropdown"><text id="username1">Default User</text></a>
                                    <span class="text-center user-semi-title text-dark">Defualt Bio</span>
                                    <div class="dropdown-divider"></div>
                                </div>
                                <a class="dropdown-item" href="#">
                                    <i class="dropdown-icon mdi mdi-account-outline"></i> Profile
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="dropdown-icon  mdi mdi-settings"></i> Settings
                                </a>
                                <a class="dropdown-item" href="#">
                                    <span class="float-right"><span class="badge badge-primary">6</span></span>
                                    <i class="dropdown-icon mdi  mdi-message-outline"></i> Inbox
                                </a>
                                <a class="dropdown-item" href="#">
                                    <i class="dropdown-icon mdi mdi-comment-check-outline"></i> Message
                                </a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">
                                    <i class="dropdown-icon mdi mdi-compass-outline"></i> Need help?
                                </a>
                                <a class="dropdown-item" href="login.html">
                                    <i class="dropdown-icon mdi  mdi-logout-variant"></i> Sign out
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="wrapper" style="background-color:white">
            <!-- serach row end-->

            <!-- Sidebar Holder -->
            <nav id="sidebar" class="nav-sidebar"  style="background-color:#041131">
                <ul class="list-unstyled components" id="accordion"  style="background-color:#041131">
                    <div class="user-profile" >
                        <div class="dropdown user-pro-body"  style="background-color:#041131">
                            <div><img src="assets\images\faces\profilePic.jpg" alt="user-img" class="img-circle"></div>
                            <div class="mb-2"><a href="#" class="" data-toggle="" aria-haspopup="true" aria-expanded="false"> <span class="font-weight-semibold"><text id="username2">Default User</text></span>  </a>
                                
                            </div>
                        </div>
                    </div>

                            <!-- user profile -->
                            <li class="">
                                <a href="#pages" class="accordion-toggle wave-effect" data-toggle="collapse" aria-expanded="false">
                                    <i class="mdi mdi-file mr-2"></i> My Profile
                                </a>
                                <ul class="collapse list-unstyled" id="pages" data-parent="#accordion">
                                    <li>
                                        <a href="profile.html">Profile</a>
                                    </li>
                                    <li>
                                        <a href="editprofile.html">Edit Profile</a>
                                    </li>
                                </ul>
                            </li>

                            <!-- Find your group/friend -->
                            <li>
                                <a href="map.html" class=" wave-effect"><i class="fa fa-map-marker mr-2"></i> Find Friends</a>
                            </li>

                            <!-- joint the event/ schedule -->
                            <li>
                                <a href="schedule1.html" class="wave-effect"><i class="fa fa-calendar mr-2"></i> Event Schedule</a>
                            </li>


                                <!-- Chat Room  -->
                            <li>
                                <a href="chat_create_event.html" class="wave-effect"><i class="fa fa-calendar mr-2"></i> Chat/Create Event</a>
                            </li>



                            <!-- my fitness plan -->
                            <li>
                                <a href="shop.html" class=" wave-effect"><i class="fa fa-cubes mr-2"></i> My Fitness Plan</a>
                            </li>

                            <!-- My meal Plan -->
                            <!-- <li>
                                <a href="mealPlan.html" class="accordion-toggle"><i class="fa fa-area-chart mr-2"></i> My Meal Plan </a>

                            </li> -->


                            <!-- calorie checker -->
                            <li class="">
                                <a href="calorieTrack.html" class="wave-effect"><i class="fa fa-snowflake-o mr-2"></i> Calorie Tracker
                                </a>
                            </li>


                            <!-- distance record -->
                            <!-- <li class="">
                                <a href="distance.html" class="wave-effect"><i class="fa fa-tachometer mr-2"></i> Running Distance
                                </a>

                            </li> -->






                        </ul>
                    </nav>
            <!-- Sidebar Holder End-->



            <!-- main content 主要内容					 -->
            <div class=" content-area">

                <div id="map" style="width:800px;height:600px;float:left;"></div>
                <div id="mapuser" style="width:20px;height:600px;float:left;">
                    Username:<text id="targetusername">None</text>
                    <!--Calories:<text id="targetcal">NaN</text>-->
                    <a id ="addfriend"class="btn btn-primary">Add Friend <i class="fa fa-plus fa-spin ml-2"></i></a>
                    <!-- <button id="addfriend">Add Friend</button> -->
                </div>

            </div>
            <!-- main content 主要内容	end				 -->


        </div>
    </div>


</div>
<a href="#" class="scroll-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>

<!-- Back to top -->
<a href="#top" id="back-to-top" style="display: inline;"><i class="fa fa-angle-up"></i></a>

<!-- Dashboard Core -->
<script src="assets\js\vendors\jquery-3.2.1.min.js"></script>
<script src="assets\js\vendors\bootstrap.bundle.min.js"></script>
<script src="assets\js\vendors\jquery.sparkline.min.js"></script>
<script src="assets\js\vendors\selectize.min.js"></script>
<script src="assets\js\vendors\jquery.tablesorter.min.js"></script>
<script src="assets\js\vendors\circle-progress.min.js"></script>
<script src="assets\plugins\rating\jquery.rating-stars.js"></script>

<!-- Fullside-menu Js-->
<script src="assets\plugins\fullside-menu\jquery.slimscroll.min.js"></script>
<script src="assets\plugins\fullside-menu\waves.min.js"></script>

<!-- Dashboard Core -->
<script src="assets\js\index1.js"></script>

<!--Morris.js Charts Plugin -->
<script src="assets\plugins\morris\raphael-min.js"></script>
<script src="assets\plugins\morris\morris.js"></script>

<!-- Custom scroll bar Js-->
<script src="assets\plugins\scroll-bar\jquery.mCustomScrollbar.concat.min.js"></script>

<!-- Custom Js-->
<script src="assets\js\custom.js"></script>

<!-- Scroll to top -->
<a href="#" class="scroll-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="js/jQuery.js"></script>
<!-- Bootstrap JS -->
<script src="assets-user/bootstrap/js/bootstrap.min.js"></script>
<!-- Lightbox JS -->
<script src="assets-user/lightbox/js/lightbox.js"></script>
<!-- Owl Carousal JS -->
<script src="assets-user/isotope/js/isotope.min.js"></script>
<!-- Owl Carousal JS -->
<script src="assets-user/owl-carousel/js/owl.carousel.min.js"></script>
<!-- Aos JS -->
<script src="assets-user/aos/aos.js"></script>
<!-- CounterUp JS -->
<script src="assets-user/counterup/counterup.min.js"></script>
<script src="assets-user/counterup/waypoints.min.js"></script>
<!-- Custom JS -->
<script src="js/custom.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAo8vjYh47C7PAAixWhUNUA5v6vYON_UoI&callback=initMap" async defer></script>
<script src="/socket.io/socket.io.js"></script>
<script src="http://cdn.bootcss.com/jquery/1.11.0/jquery.min.js" type="text/javascript"></script>
<script src="dist/notice.js"></script>
<script>
  var socket = io.connect();
  $.get('/username', function(data){
    if(data.username.length!==0){
      console.log(data.username);
      document.getElementById("username1").innerText=data.username;
      document.getElementById("username2").innerText=data.username;
      socket.emit("initid", {
        username: data.username
      });
    }
  });
  var latitude, longtitude, map;
  var latrange, lngrange;
  // latrange = 0.0464814;
  // lngrange = 0.1461157;
  latrange = 0.05;
  lngrange = 0.05;
  function initMap() {
    navigator.geolocation.getCurrentPosition(function (position) {
      // 获取成功
      latitude = position.coords.latitude;
      longtitude = position.coords.longitude;
      console.debug(position);
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: latitude, lng: longtitude},
        zoom: 12,
        draggable: false,
        zoomControl: true,
        clickableIcons: false
      });

      var maxlatnum = latitude+latrange;
      var minlatnum = latitude-latrange;
      var maxlngnum = longtitude+lngrange;
      var minlngnum = longtitude-lngrange;
      var userMarker, i;

      //get friend list
      //var friendl;
      $.get('/friendlist', function(data) {
        console.log(data);
        //friendl = data;
        socket.emit('imonline', {
          username: document.getElementById("username1").innerText,
          friendlist: data
        });
      });

      socket.on('friendonline', function(data) {
        window.alert("Your friend " + data + " is now online");
      });

      $.post('/updateLoc', {lat:latitude, lng:longtitude});
      $.get('/nearbyuser', {maxlat:maxlatnum, minlat:minlatnum, maxlng:maxlngnum, minlng:minlngnum}, function(data){
        console.log(data.rows.length);
        userMarker = new Array (data.rows.length);
        for(i=0; i<data.rows.length; i++){
          userMarker[i] = new google.maps.Marker({
            position: {lat: data.rows[i].lat, lng: data.rows[i].lng},
            map: map,
            title: data.rows[i].username
          });
          userMarker[i].addListener('click', function() {
            document.getElementById("targetusername").innerText = this.title;
            //document.getElementById("targetcal").value =

            //isfriend
            $.get('/isfriend', {username: this.title}, function(data){
              console.log(data);
              if(data){
                document.getElementById("addfriend").style.display = 'none';
              } else{
                document.getElementById("addfriend").style.display = '';
              }
            })

          });
        }
      });

      var marker = new google.maps.Marker({
        position: {lat: latitude, lng: longtitude},
        map: map,
        title: 'You'
      });
      marker.addListener('click', function() {
        document.getElementById("targetusername").innerText = "You";
        document.getElementById("addfriend").style.display = 'none';
      });

    });
  }

  document.getElementById("addfriend").onclick = function() {
    //console.log(document.getElementById("targetusername").innerText);
    $.post('/addfriend', {username:document.getElementById("targetusername").innerText}, function(data) {
      window.alert("Add Friend Success!");
    });
    socket.emit('friendrequest', {
      username: document.getElementById("username1").innerText,
      friendusername: document.getElementById("targetusername").innerText
    });
    //console.log(socket.id);

    // new NoticeJs({
    //   text: 'Notification message',
    //   position: 'middleCenter',
    //   animation: {
    //     open: 'animated zoomIn',
    //     close: 'animated zoomOut'
    //   }
    // }).show();

  };

  socket.on('friendrequest1', function(data) {
    console.log(data + "wants to be your friend");
  });



</script>
</body>
</html>
